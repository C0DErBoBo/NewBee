## 一、PRD（产品需求文档）

### 1. 产品愿景与定位

* 构建一套基于 **React + TypeScript** 的单页面应用（SPA）。
* 覆盖两个核心功能：

  1. 用户注册/登录（含报名参赛的基础支持）。
  2. 比赛创建与配置（包含项目设置）。
* 服务对象：办赛方（主要）、参赛选手（次要）。
* KPI：

  * 用户注册完成率 ≥ 90%
  * 比赛创建成功率 ≥ 95%

### 2. 用户角色与旅程

* **办赛方**：注册登录 → 创建赛事 → 配置项目 → 发布。
* **参赛选手**：注册登录 → 报名参赛（基于赛事模板）。
* **管理员（简化版）**：审核账号（可选）、导出赛事信息。

### 3. 关键场景与约束

* 用户登录基于微信/手机号 + JWT。
* 比赛创建需支持项目模板选择、组别/人群设置、报名限制等。
* 支持基础数据导出（JSON/CSV）。
* 系统需保证单机并发 500+，可后续扩展。

### 4. 功能清单

* **用户注册与登录**：手机号+验证码登录、微信授权登录，JWT 会话保持。
* **赛事管理**：

  * 后台提供办赛方 / 管理员角色按钮区分，确保不同角色进入对应的功能界面与权限范围。
  * 创建赛事（赛事名称、时间、地点、组别设置）。
  * 项目管理：选择标准田径项目（如 100m、4×100m、跳远等），支持新增/编辑。
  * 组别与报名规则配置：性别、年龄段、参赛人数上限、单人/队伍名额。
  * 比赛流程：预赛/决赛设置，晋级与成绩判定逻辑（取最好成绩/累计）。
  * 成绩与积分规则：默认积分表，可按项目调整。
  * 异常与判罚规则配置：弃权、犯规、取消成绩。
  * 管理员工具：支持批量导入队伍信息（生成账号 + 随机密码），并提供导出账号、重置密码等后续管理能力。
  * （新增）需在赛事配置中填写报名开始/结束时间与比赛开始/结束时间，系统应校验并展示这些时间信息。
  * （新增）登录成功后隐藏登录模块，通过账号信息 Tab 管理账号；赛事列表需展示报名人数、团队数量及报名/比赛时间。
  * （新增）支持系统管理员账号管理页面，可调整账号权限；手机号 15521396332 为默认系统管理员。
* **数据导出**：赛事及报名信息导出为 CSV/JSON。

### 5. 数据指标与监控

* 用户注册数、活跃登录数。
* 创建赛事次数与成功率。
* 报名人数与项目数统计。

### 6. 验收标准

* 注册/登录流程稳定，支持验证码错误重试。
* 可完整创建并保存一个赛事及多个项目。
* 配置项（项目、组别、人数限制、积分规则）能正确保存与导出。
* 前端操作 3 秒内完成响应。

---

## 二、技术方案

### 1. 前端架构

* **框架**：React + TypeScript + Vite。
* **状态管理**：Redux Toolkit（用户登录态、赛事数据），React Query（API 缓存）。
* **UI**：TailwindCSS，自建基础组件库（表单/表格/选择器）。
* **认证**：Axios 封装，JWT 鉴权。

### 2. 后端架构（简化）

* **API 服务**：Node.js + Express，部署在腾讯云 CloudBase Run。
* **数据库**：PostgreSQL（赛事、用户、报名信息）。
* **文件存储**：COS（赛事导出文件）。
* **鉴权**：手机号 + 短信验证码登录 / 微信 openId 绑定，JWT 会话。

### 3. 数据流

* 注册登录：前端表单 → API → 数据库（用户表） → 返回 JWT。
* 创建赛事：前端配置 → API → 数据库（赛事表、项目表、报名规则表）。
* 导出：数据库查询 → 生成 CSV/JSON → COS 临时下载链接。

### 4. DevOps 与运维

* **CI/CD**：GitHub Actions → 自动构建 → 部署 CloudBase。
* **一键部署**：
  * **脚本语言**：首选 Node.js（TypeScript/JavaScript），亦可使用 pnpm 执行的 shell 脚本；需保持跨平台兼容。
  * **必备环境**：Node.js 18+/pnpm 8+、已登录并配置环境变量的 CloudBase CLI、必要的腾讯云凭证。
  * **示例命令**：`pnpm deploy:cloudbase`（内部调用 `node scripts/deploy-cloudbase.ts`，完成构建、上传及发布）。
  * **失败回滚**：脚本需在部署失败时自动回滚至上一个稳定版本（使用 CloudBase 版本管理或触发 `cloudbase framework:deploy --rollback`），并输出易于追溯的日志信息。
  * **版本管理**：所有脚本与配置变更必须逐步推送到 GitHub，附带变更说明，更新部署变更日志。
* **监控**：Sentry（前端错误）、腾讯云日志服务（API 访问）。

### 5. 安全与合规

* 全链路 HTTPS。
* 用户数据加密存储（手机号、openId）。
* 日志保存不少于 30 天。

---

## 三、赛事配置与规则（保留核心）

### 1. 基础项目信息

* 默认提供田径项目：100m、200m、400m、4×100m 接力、跳远、铅球等。
* 项目类别：径赛类/田赛类。
* 单位类型：个人 / 团体。

### 2. 组别与人群设置

* 性别：男子 / 女子 / 混合。
* 年龄组：少年 / 青年 / 成年。
* 参赛身份：运动员 / 学生 / 教师。

### 3. 报名限制

* 每人最多报名 N 个项目。
* 团体项目需固定人数（如接力 4 人）。

### 4. 成绩与积分

* 成绩单位：秒、米。
* 积分方式：1–8 名 9/7/6/5/4/3/2/1 分。

### 5. 模板与扩展

* 提供赛事模板：田径通用。
* 支持赛事创建时复制模板并调整。
* 支持保存为自定义模板。
