# TODO 任务清单

> 说明：依据《需求文档.md》与当前实现状态整理，按优先级/模块划分。勾选项表示已完成，未勾选为待办。更新需求或实现后需同步维护本清单。

## 0. 发布与自动化（P0）
- [x] 建立 CloudBase 部署脚本与 GitHub Actions 流水线，记录部署变更（`scripts/deploy-cloudbase.cjs` + `.github/workflows/deploy.yml` 已可用，执行后写入 `CHANGELOG_DEPLOY.md`）。
- [ ] 部署流程补充自动化冒烟测试与健康检查，部署失败自动回滚并通知。
- [ ] 支持测试/生产多环境部署参数、凭据校验与安全审计。

## 1. 基础设施与开发体验（P1）
- [x] 初始化前端（React + Vite + Tailwind + shadcn/ui）与后端（Express + TS）工程结构（`frontend/`、`backend/` 目录已成型，含 lint/format 配置）。
- [x] 建立 PostgreSQL 迁移脚本（users、competitions、events、groups、rules、teams、registrations 等）（`backend/src/database/client.ts` 可重复执行并适配 uuid 扩展）。
- [x] 封装 axios、Redux Toolkit、React Query 底层能力（`frontend/src/lib/axios.ts`、`store/authSlice.ts`、`queryClient.ts` 已支撑鉴权与缓存）。
- [ ] 补充 `.env.example`、配置自检与本地一键启动（含数据库种子）。
- [ ] 为开发环境提供模拟数据/模板，以支撑项目、判罚、赛次演示。

## 2. 用户认证与账号体系（P0）
- [x] 手机验证码 + 微信授权登录、JWT 签发/刷新/吊销（`backend/src/routes/auth.ts` + tokenService + verificationCodeService 已上线）。
- [x] 登录页交互与 token 自动刷新（`App.tsx` 登录卡片 + axios refresh 队列已验证，Vitest 覆盖关键路径）。
- [ ] 接入短信网关，完善验证码发送频控与告警。
- [ ] 支持账号审核/封禁、管理员审批流程与审计日志。
- [ ] 增强安全策略：手机号/OpenID 加密存储、登录失败告警、CAPTCHA（视需要）。

## 3. 赛事创建与配置（P0）
- [x] 支持赛事列表、创建向导、详情面板（基础信息/项目/组别/规则/报名配置）（`CompetitionWizard` + `CompetitionDetailPanel` 已联通后端）。
- [x] 实现项目模板与事务写入逻辑（`GET /competitions/templates/events` + `POST/PATCH /competitions` 结合事务处理）。
- [ ] 拆分赛事配置步骤：向导支持保存草稿、草稿/发布状态、复制赛事。
- [ ] 扩展项目数据结构：项目类型（田径/全能/趣味/评分类）、赛道模式（分道/不分道）、计分类型（计时/远度/高度）已在需求中定义，需要前端/后端联动落地。
- [ ] 赛次管理：创建/复制/排序赛次、容量限制、报名联动、导出赛程。
- [ ] 计分规则可视化：每项目自定义积分表、晋级逻辑、全能换算表接入。
- [ ] 报名限制 UI：结构化配置单人限报、实名要求、附件校验。
- [ ] 冲突校验：项目/赛次变更影响报名/成绩/判罚时给予提醒与阻断。

## 4. 判罚规则与成绩处理（P0）
- [ ] 建立独立判罚规则管理页面：批量导入/导出判罚编号与内容，支持启用/停用。
- [ ] 项目绑定判罚规则集，成绩处理页可选择判罚并自动记录操作人、时间、结果。
- [ ] 判罚日志与撤销机制，支持仲裁导出。
- [ ] 成绩处理页需基于计分类型提供默认排序、成绩单位与晋级自动化。

## 5. 报名与队伍管理（P0）
- [x] 报名管理页（筛选、分页、审批、备注、取消、统计）（`RegistrationManager` 已上线，覆盖审批/撤销用例）。
- [x] 队伍花名册（成员维护、批量粘贴、报名同步）（`TeamMembersManager` 支持 Excel 风格粘贴并写回 `/team/members`）。
- [ ] 报名创建体验：参赛端可视化表单（个人/团体/附件上传/赛次选择）。
- [ ] 批量审批、批量导出报名凭证、通知（短信/邮件/企业微信）。
- [ ] 队伍花名册 CSV 模板下载、错误提示导出、操作历史与回滚。
- [ ] 赛次容量控制与报名冲突检测。

## 6. 账号管理与批量操作（P0）
- [x] 账号列表、角色切换、默认管理员赋权（`/admin/accounts` 接口 + `App.tsx` 管理员 Tab 已可操作，默认手机号 15521396332 升级为 admin）。
- [ ] 管理页面补充队伍名称列显示。
- [ ] 批量创建队伍：支持 Excel 粘贴（逗号分隔大小写/全角半角兼容）、预览校验、随机密码生成与结果展示。
- [ ] 批量导入队伍（含成员）上传 UI、错误反馈、去重提示。
- [ ] 队伍账号批量导出（含脱敏选项）、密码重置 UI 与通知流程。
- [ ] 管理操作审计日志、操作历史面板与权限校验。

## 7. 数据导出与存储（P0）
- [ ] 赛事/报名/成绩/积分榜 CSV+JSON 导出，数据与数据库一致。
- [ ] 导出文件上传至 COS，生成限时下载链接并保存操作日志。
- [ ] 前端导出入口与历史记录、失败重试、权限控制。
- [ ] 导出/上传过程监控与告警。

## 8. 指标与监控（P0）
- [ ] 接入 Sentry（前端）与腾讯云 CLS（后端），定义错误/性能指标。
- [ ] 上报关键业务指标：注册人数、活跃度、赛事创建次数/成功率、报名人数、审批耗时。
- [ ] 建立运维看板、SLA 监控、错误率告警。
- [ ] 部署流水线与关键接口增加监控探针。

## 9. 安全与合规（P0）
- [ ] 手机号、OpenID 等敏感字段加密/脱敏存储。
- [ ] 构建操作审计表（赛事配置、审批、导出、角色变更等）。
- [ ] RBAC 自动化测试，防止越权访问。
- [ ] HTTPS/TLS、CSP、安全头配置、渗透测试排期。

## 10. 文档与协作（P1）
- [x] 合并需求文档，保持唯一业务来源（《需求文档.md》现包含原需求文件全部内容，并备份至《需求文件1.md》）。
- [ ] 补充 README / STATUS，说明启动方式、接口约定、部署流程。
- [ ] 维护需求变更流程与 PR 模板（影响范围、验证方式、指标影响）。
- [ ] 定期评审 TODO 优先级，并与 PM/RD 对齐排期。
