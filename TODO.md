# TODO 任务清单

## 0. 部署与自动化
- [x] 设计并实现一键部署脚本/工具，覆盖 CloudBase CLI 与 API，确保每次改动同步 GitHub 版本与变更记录。
- [x] 持续维护 GitHub Actions 流水线，校验安装、测试、构建、CloudBase 部署与回滚的可追踪性。
- [x] 部署脚本执行后更新 `CHANGELOG_DEPLOY.md`，记录时间、提交信息与回滚处理细节。

## 1. 项目初始化与基础设施
- [x] 初始化前端工程（React + TypeScript + Vite），接入 TailwindCSS 与 shadcn/ui。
- [x] 配置 Redux Toolkit 与 React Query，搭建全局 store 与接口缓存策略。
- [x] 初始化 Node.js + Express 后端工程，完成 TypeScript、ESLint、Prettier、目录结构约定。
- [x] 搭建 PostgreSQL 环境并准备迁移脚本，覆盖用户、赛事、项目、分组等核心表。
- [x] 完成 Axios 封装，统一鉴权、错误处理与请求重试策略。

## 2. 用户注册与登录
- [x] 定义用户数据模型（手机号、微信 OpenID、角色、状态等）。
- [x] 实现手机号验证码登录：验证码生成、发送、校验、重试与防刷策略。
- [x] 对接微信授权登录，完成 OpenID 绑定与账号合并逻辑。
- [x] 实现 JWT 签发、刷新、失效逻辑，确保会话安全可控。
- [x] 构建前端登录/注册页面：手机号＋验证码、微信授权入口、状态提示。
- [x] 编写登录相关服务端测试，覆盖验证码、刷新令牌等关键路径。
- [x] 登录成功后在前端展示提示并 2-3 秒内自动渐隐，可手动关闭。

## 3. 赛事配置与管理
- [x] 后端提供办赛方/管理员角色划分，明确权限范围。
- [x] 设计赛事、项目、报名规则的数据模型与关联关系。
- [x] 提供赛事创建 API，涵盖基础信息、时间地点、模板选择。
- [x] 完成标准项目模板 CRUD 及自定义模板保存能力。
- [x] 实现报名规则配置 API：性别、年龄、身份、人数限制、团队名额等。
- [x] 支持赛程流程配置 API：预赛/决赛、晋级、成绩判定（最好/累计）。
- [x] 完成异常处理配置 API：弃权、犯规、取消成绩等。
- [x] 提供管理员账号管理页面，可查看并分配权限（默认管理员：15521396332）。
- [x] 交付赛事配置相关的前端页面与表单，包含表单校验与状态提示。
- [x] 为关键接口编写集成测试，覆盖创建、修改、审批等流程。
- [x] 完成登录后首页回显（账户信息 Tab、赛事卡片列表等）。
- [x] 赛事明细支持列表视图，展示队伍、赛程时间等信息。
- [x] 实现赛事列表页：分页、搜索、排序，支持点击进入赛事详情页编辑配置。
- [x] 在赛事列表页添加 `新增比赛` 按钮，点击打开赛事配置向导。
- [x] 构建赛事详情页，按照模块（基础信息、项目、积分、报名规则等）创建tab页分区编辑并记录变更。
- [ ] 重构赛事配置向导为五步流程（基础信息 → 项目与组别 → 日程分组 → 成绩与预览设置 → 汇总确认）。
- [ ] 支持向导草稿保存、步骤回退、校验提示与继续编辑流程。

## 3.5 参赛队伍端增强
- [x] 队伍端报名管理页移除审批操作，仅展示已报名赛事及基础信息（状态、提交时间、参赛成员等）。
- [x] 新增队员管理页面：支持按照“姓名,性别,组别,项目一,成绩一,项目二,成绩二,项目三,成绩三,项目四,成绩四,项目五,成绩五”格式批量录入，并在下方表格展示全部队员报名详情。
- [x] 队伍端赛事管理页去除“设置”“向导”等模块，仅保留赛事基础信息及操作入口，新增“去报名”按钮跳转至报名管理。
- [x] 赛事管理操作列新增“队员管理”按钮，弹窗默认带入当前赛事并支持直接打开队员管理。
- [x] 队员管理弹窗增加赛事下拉框，可切换/确认当前赛事并联动可选项目限制。
- [x] 队员管理列表支持下拉方式修改队员的参赛项目/组别等信息，保留后续编辑与删除入口。
- [x] “去报名”按钮直达报名管理并默认带入当前赛事，保持队伍端报名操作顺畅。
- [x] 保存队员后立即同步对应赛事的报名人数，并在报名管理中显示报名队伍与队员。
- [x] 队员管理保存时将所选队员同步写入目标赛事的报名记录及项目列表，确保报名数据一致。

## 4. 积分规则模型模块
- [ ] 设计积分规则数据库模型，支持赛事级默认表与项目级覆写，并记录版本。
- [ ] 实现默认积分表（1-8 名对应 9/7/6/5/4/3/2/1）及赛事级自定义 API。
- [ ] 支持项目级积分覆写：名次上限、平局策略、个人/团体赛计算方式。
- [ ] 实现额外加分/扣分配置（破纪录、判罚等），并记录触发条件与操作者。
- [ ] 前端提供积分规则配置表单与实时预览组件，展示名次-积分映射。
- [ ] 编写单元与集成测试，验证积分方案保存、回显与版本回滚。

## 5. 成绩录入与异常处理模块
- [ ] 设计成绩录入流程（手动录入、批量导入），定义字段与模板。
- [ ] 实现成绩录入 API，包含单位转换、晋级判定、累计/最好成绩计算。
- [ ] 支持异常状态（弃权、犯规、取消成绩、重赛）及备注、附件上传。
- [ ] 构建复核流程：双人复核或系统二次校验，保留操作日志与历史版本。
- [ ] 前端提供成绩录入界面、导入校验反馈、异常标记与日志查看。
- [ ] 成绩变更需同步刷新积分榜、预览界面，并触发通知（站内/短信）。
- [ ] 编写端到端测试，验证成绩录入、异常处理与积分联动的正确性。

## 6. 前端预览界面模块
- [ ] 设计赛事预览页面信息架构与 UI（基于 shadcn/ui + Tailwind CSS）。
- [ ] 对接预览数据接口，展示基础信息、项目、分组、积分方案摘要、赛程流程。
- [ ] 实现实时积分榜与成绩列表展示，异常状态需醒目标注。
- [ ] 优化性能：骨架屏、懒加载、虚拟列表，首屏渲染 < 1.5 秒。
- [ ] 控制访问权限：公开赛事匿名可见，办赛方可从预览跳转编辑。
- [ ] 支持从配置向导与详情页打开预览，保持状态一致与刷新校验。
- [ ] 编写可视化回归/截图或关键交互测试，确保渲染与数据一致性。

## 7. 报名选手流程
- [x] 实现报名 API，支持选手选择赛事、项目、团队信息与附件上传。
- [ ] 支持报名校验（人数、项目限制、冲突检查），返回清晰错误提示。
- [x] 构建选手报名管理界面：列表、状态筛选、进度提示、修改撤销能力。
- [ ] 支持报名审核：批量审核、候补名单、通知推送。
- [ ] 编写报名流程测试，覆盖超额、重复、撤销等场景。

## 8. 数据导出与存储
- [ ] 完成赛事、报名、成绩、积分榜的 CSV/JSON 导出能力。
- [ ] 接入 COS 存储导出文件，生成带过期时间的下载链接。
- [ ] 前端实现导出任务进度、历史记录、失败重试提醒。
- [ ] 记录导出审计日志，确保可追踪与权限校验。

## 9. 监控、运维与安全
- [ ] 集成 Sentry（前端）与腾讯云日志服务（后端），采集关键指标。
- [ ] 构建运营看板：注册转化、赛事创建成功率、报名统计、导出成功率等。
- [ ] 落实 HTTPS、敏感信息加密、日志 ≥ 30 天保留策略。
- [ ] 编写运维手册：部署流程、故障排查、日志查询、指标告警处理。

## 10. 协作与文档对齐
- [ ] 在 README/STATUS 中链接 AGENTS.md，确保团队遵循协作指南。
- [ ] 迭代需求需同步更新《需求文档.md》与 TODO 清单，并与 PM/RD 确认。
- [ ] 定期梳理 TODO，调整优先级并对齐业务指标影响。


