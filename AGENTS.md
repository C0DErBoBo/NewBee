# AGENTS 协作指南

## 0. 协作规则
- 始终使用 UTF-8 编码创建或修改本地文件。
- 所有回复均使用简体中文。
- 需要调整前端页面时，请基于 shadcn/ui 与 Tailwind CSS 实现。
- 在现有基础上延续需求文档定义的业务目标与约束，保持设计与实现一致。

## 1. 项目愿景与定位
- 打造一套基于 **React + TypeScript** 的单页面应用（SPA），主要服务办赛方，兼顾参赛选手与简化版管理员。
- 当前聚焦两大能力：用户注册/登录（含报名基础支持）与赛事创建配置（覆盖项目设置与流程管理）。
- 核心成功指标：用户注册完成率 ≥ 90%，赛事创建成功率 ≥ 95%，遵循需求文档给出的业务 KPI。

## 2. 用户角色与旅程
- **办赛方**：注册登录 → 创建赛事 → 配置项目与规则 → 发布赛事 → 导出数据。
- **参赛选手**：注册登录 → 选择赛事 → 填写报名信息 → 跟踪参赛安排。
- **管理员（简化版）**：审核账号（可选） → 导出赛事与报名信息。
- 设计交互时需确保以上旅程顺畅，尤其是办赛方的配置流程与参赛选手的报名体验。

## 3. 核心场景与约束
- 登录方式需覆盖手机号 + 验证码以及微信授权，后端基于 JWT 维持会话。
- 赛事创建必须支持项目模板选择、分组/人群设定、报名限制与流程配置。
- 提供赛事与报名数据导出能力（JSON/CSV），并保证导出内容与数据库一致。
- 系统目标并发能力 ≥ 500，需在设计与实现中保留可扩展空间。
- 前端交互需在 3 秒内响应关键操作，必要时进行性能优化与懒加载。

## 4. 功能清单与验收标准
- **注册与登录**：手机号 + 验证码校验，微信 OpenID 绑定，错误验证码需支持重试；JWT 会话续期策略需明确。
- **赛事管理**：
  - 创建赛事：名称、时间、地点、组别与流程。
  - 项目管理：提供标准田径项目（100m、200m、4×100m、跳远、铅球等），支持增删改。
  - 报名规则：性别/年龄段/身份维度配置，参赛人数上限与团队名额。
  - 赛程流程：预赛/决赛、晋级与成绩判定逻辑（取最好成绩或累计）。
  - 成绩与积分：默认积分表，可按项目覆写；支持异常与判罚（弃权、犯规、取消成绩）。
- **数据导出**：实现赛事及报名信息的 CSV/JSON 导出链路，并与存储服务对接。
- 验收关注点：完整配置一个赛事及多个项目，数据可正确保存、导出，关键操作稳定可追踪。

## 5. 数据指标与监控
- 跟踪注册人数、活跃登录数、赛事创建次数与成功率、各赛事报名人次及项目数量。
- 建议在前后端埋点中记录关键链路，结合后端日志与监控服务进行统计。
- 响应 SLA 与错误率需纳入运营看板，及时反馈给开发团队。

## 6. 技术方案概览
- **前端架构**：
  - 技术栈：React + TypeScript + Vite。
  - 状态管理：Redux Toolkit 管理用户态与赛事数据，React Query 缓存接口请求。
  - UI：TailwindCSS + 自建组件库（表单/表格/选择器），结合 shadcn/ui 规范组件风格。
  - 网络层：Axios 封装，统一处理鉴权、错误提示与请求重试。
- **后端服务**：
  - Node.js + Express，部署于腾讯云 CloudBase Run。
  - 数据库：PostgreSQL，存储用户、赛事、项目、报名、配置等核心数据。
  - 文件存储：COS 用于导出文件与临时下载链接。
  - 鉴权：手机号验证码、微信 OpenID 绑定，JWT 作为会话令牌并支持刷新。
- **数据流转**：
  - 注册登录 → API → 用户表 → 返回 JWT。
  - 赛事配置 → API → 赛事/项目/报名规则表。
  - 导出流程：数据库查询 → 生成 CSV/JSON → 上传 COS → 返回下载地址。
- **DevOps 与运维**：
  - 持续集成：GitHub Actions 负责构建与部署流水线。
  - 发布流程：遵循《需求文档.md》“一键部署”规范：脚本使用 Node.js/TypeScript 或兼容 shell，依赖 Node.js 18+/pnpm 8+ 与 CloudBase CLI 配置；执行示例 `pnpm deploy:cloudbase`，需支持失败自动回滚上一稳定版本，所有改动同步推送至 GitHub 并更新部署变更日志。
  - 监控告警：前端集成 Sentry，后端对接腾讯云日志服务。
  - 日志保留不少于 30 天，确保排查问题可追溯。
- **安全合规**：
  - 全链路 HTTPS，敏感字段（手机号、OpenID）需加密存储。
  - 访问与操作日志需具备审计能力，保证数据安全。

## 7. 赛事配置要点
- **项目模板**：默认田径项目集，按径赛/田赛分类；支持个人与团体赛制。
- **组别配置**：性别（男子/女子/混合）、年龄（少年/青年/成年）、身份（运动员/学生/教师）等维度。
- **报名限制**：设置个人参赛项目数上限，团体项目需配置固定人数（如接力 4 人）。
- **成绩与积分**：成绩单位（秒、米等）可配置；积分规则默认 9/7/6/5/4/3/2/1，可按项目覆写。
- **模板扩展**：赛事可从标准模板复制并调整，也可保存为自定义模板以复用。

## 8. 协作提示
- 需求文档为唯一业务来源，新增或更新功能需先与 PM/RD 对齐需求并同步此文档。
- 开发任务需显式记录影响范围、接口变更与数据迁移方案。
- 提交代码前确保通过本地测试，并在 PR 中说明功能点、验证方式与影响的指标。
- 部署脚本与自动化管道列为最高优先级事项（参考 `TODO.md` 第 0 节），需优先排期并对齐进度。
- 如发现实现与本指南冲突，需优先更新需求文档并同步修改本指南，确保信息一致。
